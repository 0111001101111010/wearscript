<html style="width:100%; height:100%; overflow:hidden">
<head><script src="https://api.picar.us/wearscriptdev/static/msgpack.js"></script></head>
<body style="width:100%; height:100%; overflow:hidden; margin:0" bgcolor="#000000">
<script>
function enc(data) {
    var data_enc = msgpack.pack(data);
    var data_out = '';
    var i;
    for (i = 0; i < data_enc.length; i++) {
        data_out += String.fromCharCode(data_enc[i])
    }
    return btoa(data_out);
}
function onScroll(v, v2, v3) {
    WS.log('onScroll: ' + v + ', ' + v2 + ', ' + v3);
    var v = Math.min(180, Math.max(0, v / 6));
    WS.log('V: ' + v);
    WS.blobSend('arduino', enc([0, Math.round(v)]));
}
function onGesture(v) {
    WS.log('Gesture: ' + v);
    if (v == 'TAP')
        WS.blobSend('arduino', enc([3, 0]));
    else if (v == 'TWO_TAP')
        WS.blobSend('arduino', enc([3, 1]));
}   
function setPixelColor(led, r, g, b) {
    return [255, 0, led, r, g, b];
}
function setBrightness(l) {
    return [255, 1, l, 0, 0, 0];
}
function show() {
    return [255, 2, 0, 0, 0, 0];
}
function delay(l) {
    return [255, 3, l, 0, 0, 0];
}

function startLoop() {
    return [255, 4, 0, 0, 0, 0];
}

function finishLoop() {
    return [255, 5, 0, 0, 0, 0];
}
    
function send(data) {
    WS.blobSend('arduino', enc(data));
}

function server() {
    WS.log('Welcome to WearScript');
    //setPixelColor(1, 255, 255, 255);
    //show();
        var data = [];
    data = data.concat(startLoop());
    for (var i = 0; i < 32; i++)
      data = data.concat(setPixelColor(i, 0, 0, 0));
    data = data.concat(show());
    for (var i = 0; i < 32; i++) {
			data = data.concat(setPixelColor(i, i * 50 % 256, i * 17 % 256, i * 98 % 256));
        //delay(100);
			data = data.concat(show());
    }
    data = data.concat(finishLoop());
    send(data)
    //setBrightness(200);
    //WS.gestureCallback('onScroll', 'onScroll');
    //WS.gestureCallback('onGesture', 'onGesture');
}
function main() {
    if (WS.scriptVersion(0)) return;
    WS.serverConnect('{{WSUrl}}', 'server');
}
window.onload = main;
</script>
</body>
</html>
